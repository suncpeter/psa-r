<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Section 5.8.5 Multilevel Propensity Score (PS) | R Code for Propensity Score Analysis</title>
  <meta name="description" content="7 Section 5.8.5 Multilevel Propensity Score (PS) | R Code for Propensity Score Analysis" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Section 5.8.5 Multilevel Propensity Score (PS) | R Code for Propensity Score Analysis" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Section 5.8.5 Multilevel Propensity Score (PS) | R Code for Propensity Score Analysis" />
  
  
  

<meta name="author" content="Shanshan Du, Peter Sun, and Shenyang Guo" />


<meta name="date" content="2020-12-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="05_Section5.8.2_5.8.3_5.8.4.html"/>
<link rel="next" href="07_Section5.8.6.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface<span></span></a></li>
<li class="chapter" data-level="2" data-path="01_Section4.4.1.html"><a href="01_Section4.4.1.html"><i class="fa fa-check"></i><b>2</b> Section 4.4.1 Application of the Treatment Effect Model to Analysis of Observational Data (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="01_Section4.4.1.html"><a href="01_Section4.4.1.html#preparation"><i class="fa fa-check"></i><b>2.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="01_Section4.4.1.html"><a href="01_Section4.4.1.html#treatment-effect"><i class="fa fa-check"></i><b>2.2</b> Treatment Effect<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="01_Section4.4.1.html"><a href="01_Section4.4.1.html#bivariate-t-test"><i class="fa fa-check"></i><b>2.3</b> Bivariate t-test<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="01_Section4.4.1.html"><a href="01_Section4.4.1.html#regression-control"><i class="fa fa-check"></i><b>2.4</b> Regression Control<span></span></a></li>
<li class="chapter" data-level="2.5" data-path="01_Section4.4.1.html"><a href="01_Section4.4.1.html#sample-description"><i class="fa fa-check"></i><b>2.5</b> Sample Description<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="02_Section4.4.2.html"><a href="02_Section4.4.2.html"><i class="fa fa-check"></i><b>3</b> Section 4.4.2 Evaluation of Treatment Effects From a Program With a Group Randomization Design (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="02_Section4.4.2.html"><a href="02_Section4.4.2.html#preparation-1"><i class="fa fa-check"></i><b>3.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="02_Section4.4.2.html"><a href="02_Section4.4.2.html#treatment-effect-using-robust-to-control-for-clustering"><i class="fa fa-check"></i><b>3.2</b> Treatment Effect: Using Robust to Control for Clustering<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="02_Section4.4.2.html"><a href="02_Section4.4.2.html#bivariate-t-test-1"><i class="fa fa-check"></i><b>3.3</b> Bivariate t-test<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="03_Section4.4.3.html"><a href="03_Section4.4.3.html"><i class="fa fa-check"></i><b>4</b> Section 4.4.3 Main Features of Treatreg (PS &amp; SD)<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="03_Section4.4.3.html"><a href="03_Section4.4.3.html#preparation-2"><i class="fa fa-check"></i><b>4.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="03_Section4.4.3.html"><a href="03_Section4.4.3.html#run-models"><i class="fa fa-check"></i><b>4.2</b> Run Models<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="03_Section4.4.3.html"><a href="03_Section4.4.3.html#extract-coefficients"><i class="fa fa-check"></i><b>4.3</b> Extract Coefficients<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="03_Section4.4.3.html"><a href="03_Section4.4.3.html#get-combined-results"><i class="fa fa-check"></i><b>4.4</b> Get Combined Results<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="03_Section4.4.3.html"><a href="03_Section4.4.3.html#results"><i class="fa fa-check"></i><b>4.5</b> Results<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html"><i class="fa fa-check"></i><b>5</b> Section 5.8.1 Greedy Matching and Subsequent Analysis of Hazard Rates (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#preparation-3"><i class="fa fa-check"></i><b>5.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#propensity-score-estimation"><i class="fa fa-check"></i><b>5.2</b> Propensity Score Estimation<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#bivariate-comparisons"><i class="fa fa-check"></i><b>5.3</b> Bivariate Comparisons<span></span></a></li>
<li class="chapter" data-level="5.4" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#psm-based-on-logistic-regression-covariate-balcance-check"><i class="fa fa-check"></i><b>5.4</b> PSM based on Logistic regression &amp; Covariate Balcance Check<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-1---nearest-neighbor-within-caliper-.25sd"><i class="fa fa-check"></i><b>5.4.1</b> Scheme 1 - Nearest neighbor within caliper .25*SD<span></span></a></li>
<li class="chapter" data-level="5.4.2" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-2---nearest-neighbor-within-caliper-.1sd"><i class="fa fa-check"></i><b>5.4.2</b> Scheme 2 - Nearest neighbor within caliper .1*SD<span></span></a></li>
<li class="chapter" data-level="5.4.3" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-3---mahalanobis-without-propensity-score"><i class="fa fa-check"></i><b>5.4.3</b> Scheme 3 - Mahalanobis without propensity score<span></span></a></li>
<li class="chapter" data-level="5.4.4" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-4---mahalanobis-with-propensity-score"><i class="fa fa-check"></i><b>5.4.4</b> Scheme 4 - Mahalanobis with propensity score<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#psm-based-on-logistic-regression-2"><i class="fa fa-check"></i><b>5.5</b> PSM based on Logistic regression 2<span></span></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-5---nearest-neighbor-within-caliper-.25sd"><i class="fa fa-check"></i><b>5.5.1</b> Scheme 5 - Nearest neighbor within caliper .25*SD<span></span></a></li>
<li class="chapter" data-level="5.5.2" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-6---nearest-neighbor-within-caliper-.1sd-note-caliper-in-matchit-is-not-real-data"><i class="fa fa-check"></i><b>5.5.2</b> Scheme 6 - Nearest neighbor within caliper .1*SD (Note: caliper in MatchIt is not real data)<span></span></a></li>
<li class="chapter" data-level="5.5.3" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-7---mahalanobis-without-propensity-score"><i class="fa fa-check"></i><b>5.5.3</b> Scheme 7 - Mahalanobis without propensity score<span></span></a></li>
<li class="chapter" data-level="5.5.4" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-8---mahalanobis-with-propensity-score"><i class="fa fa-check"></i><b>5.5.4</b> Scheme 8 - Mahalanobis with propensity score<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#psm-based-on-logistic-regression-3"><i class="fa fa-check"></i><b>5.6</b> PSM based on Logistic regression 3<span></span></a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-9---nearest-neighbor-within-caliper-.25sd"><i class="fa fa-check"></i><b>5.6.1</b> Scheme 9 - Nearest neighbor within caliper .25*SD<span></span></a></li>
<li class="chapter" data-level="5.6.2" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-10---nearest-neighbor-within-caliper-.1sd"><i class="fa fa-check"></i><b>5.6.2</b> Scheme 10 - Nearest neighbor within caliper .1*SD<span></span></a></li>
<li class="chapter" data-level="5.6.3" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-11---mahalanobis-without-propensity-score"><i class="fa fa-check"></i><b>5.6.3</b> Scheme 11 - Mahalanobis without propensity score<span></span></a></li>
<li class="chapter" data-level="5.6.4" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-12---mahalanobis-with-propensity-score"><i class="fa fa-check"></i><b>5.6.4</b> Scheme 12 - Mahalanobis with propensity score<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#bivariate-test-after-matching"><i class="fa fa-check"></i><b>5.7</b> Bivariate test after matching<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#kaplan-meier-and-significance-test-of-difference-on-survivor-function"><i class="fa fa-check"></i><b>5.8</b> Kaplan-Meier and significance test of difference on survivor function<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#all"><i class="fa fa-check"></i><b>5.8.1</b> All<span></span></a></li>
<li class="chapter" data-level="5.8.2" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-1"><i class="fa fa-check"></i><b>5.8.2</b> Scheme 1<span></span></a></li>
<li class="chapter" data-level="5.8.3" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-2"><i class="fa fa-check"></i><b>5.8.3</b> Scheme 2<span></span></a></li>
<li class="chapter" data-level="5.8.4" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-3"><i class="fa fa-check"></i><b>5.8.4</b> Scheme 3<span></span></a></li>
<li class="chapter" data-level="5.8.5" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-4"><i class="fa fa-check"></i><b>5.8.5</b> Scheme 4<span></span></a></li>
<li class="chapter" data-level="5.8.6" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-5"><i class="fa fa-check"></i><b>5.8.6</b> Scheme 5<span></span></a></li>
<li class="chapter" data-level="5.8.7" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-6"><i class="fa fa-check"></i><b>5.8.7</b> Scheme 6<span></span></a></li>
<li class="chapter" data-level="5.8.8" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-7"><i class="fa fa-check"></i><b>5.8.8</b> Scheme 7<span></span></a></li>
<li class="chapter" data-level="5.8.9" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-8"><i class="fa fa-check"></i><b>5.8.9</b> Scheme 8<span></span></a></li>
<li class="chapter" data-level="5.8.10" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-9"><i class="fa fa-check"></i><b>5.8.10</b> Scheme 9<span></span></a></li>
<li class="chapter" data-level="5.8.11" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-10"><i class="fa fa-check"></i><b>5.8.11</b> Scheme 10<span></span></a></li>
<li class="chapter" data-level="5.8.12" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-11"><i class="fa fa-check"></i><b>5.8.12</b> Scheme 11<span></span></a></li>
<li class="chapter" data-level="5.8.13" data-path="04_Section5.8.1.html"><a href="04_Section5.8.1.html#scheme-12"><i class="fa fa-check"></i><b>5.8.13</b> Scheme 12<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html"><i class="fa fa-check"></i><b>6</b> Section 5.8.2, 5.8.3, and 5.8.4 (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#section-5.8.2-optimal-matching"><i class="fa fa-check"></i><b>6.1</b> Section 5.8.2 Optimal Matching<span></span></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#load-data"><i class="fa fa-check"></i><b>6.1.1</b> Load Data<span></span></a></li>
<li class="chapter" data-level="6.1.2" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#bivariate-comparisons-1"><i class="fa fa-check"></i><b>6.1.2</b> Bivariate Comparisons<span></span></a></li>
<li class="chapter" data-level="6.1.3" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#outcome-without-bias-control"><i class="fa fa-check"></i><b>6.1.3</b> Outcome Without Bias Control<span></span></a></li>
<li class="chapter" data-level="6.1.4" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#matching"><i class="fa fa-check"></i><b>6.1.4</b> Matching<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#section-5.8.3-post-full-matching-analysis-of-outcome"><i class="fa fa-check"></i><b>6.2</b> Section 5.8.3 Post-Full-Matching Analysis of Outcome<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#hodges-lehmann-aligned-rank-test"><i class="fa fa-check"></i><b>6.2.1</b> Hodges-Lehmann Aligned Rank Test<span></span></a></li>
<li class="chapter" data-level="6.2.2" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#cohens-d"><i class="fa fa-check"></i><b>6.2.2</b> Cohen’s d<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="05_Section5.8.2_5.8.3_5.8.4.html"><a href="05_Section5.8.2_5.8.3_5.8.4.html#section-5.8.4-post-matching-analysis-using-regression-of-difference-scores"><i class="fa fa-check"></i><b>6.3</b> Section 5.8.4 Post-Matching Analysis Using Regression of Difference Scores<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html"><i class="fa fa-check"></i><b>7</b> Section 5.8.5 Multilevel Propensity Score (PS)<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#cccpros57"><i class="fa fa-check"></i><b>7.1</b> cccpros57<span></span></a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#import-data"><i class="fa fa-check"></i><b>7.1.1</b> Import Data<span></span></a></li>
<li class="chapter" data-level="7.1.2" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#obtain-single-level-p-score"><i class="fa fa-check"></i><b>7.1.2</b> Obtain Single-Level p-score<span></span></a></li>
<li class="chapter" data-level="7.1.3" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#obtain-school-level-p-score-model"><i class="fa fa-check"></i><b>7.1.3</b> Obtain School-Level p-score Model<span></span></a></li>
<li class="chapter" data-level="7.1.4" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#before-matching-balance-check"><i class="fa fa-check"></i><b>7.1.4</b> Before-Matching Balance Check<span></span></a></li>
<li class="chapter" data-level="7.1.5" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#matching-with-ps_sgl"><i class="fa fa-check"></i><b>7.1.5</b> Matching with ps_sgl<span></span></a></li>
<li class="chapter" data-level="7.1.6" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#matching-with-ps_sch"><i class="fa fa-check"></i><b>7.1.6</b> Matching with ps_sch<span></span></a></li>
<li class="chapter" data-level="7.1.7" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#check-icc"><i class="fa fa-check"></i><b>7.1.7</b> Check ICC<span></span></a></li>
<li class="chapter" data-level="7.1.8" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#outcome-analsis-multilevel"><i class="fa fa-check"></i><b>7.1.8</b> Outcome Analsis: Multilevel<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#cccragg24"><i class="fa fa-check"></i><b>7.2</b> cccragg24<span></span></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#import-data-1"><i class="fa fa-check"></i><b>7.2.1</b> Import Data<span></span></a></li>
<li class="chapter" data-level="7.2.2" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#obtain-single-level-p-score-1"><i class="fa fa-check"></i><b>7.2.2</b> Obtain Single-Level p-score<span></span></a></li>
<li class="chapter" data-level="7.2.3" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#obtain-school-level-p-score-model-1"><i class="fa fa-check"></i><b>7.2.3</b> Obtain School-Level p-score Model<span></span></a></li>
<li class="chapter" data-level="7.2.4" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#before-matching-balance-check-1"><i class="fa fa-check"></i><b>7.2.4</b> Before-Matching Balance Check<span></span></a></li>
<li class="chapter" data-level="7.2.5" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#matching-with-ps_sgl-1"><i class="fa fa-check"></i><b>7.2.5</b> Matching with ps_sgl<span></span></a></li>
<li class="chapter" data-level="7.2.6" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#matching-with-ps_sch-1"><i class="fa fa-check"></i><b>7.2.6</b> Matching with ps_sch<span></span></a></li>
<li class="chapter" data-level="7.2.7" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#check-icc-1"><i class="fa fa-check"></i><b>7.2.7</b> Check ICC<span></span></a></li>
<li class="chapter" data-level="7.2.8" data-path="06_Section5.8.5.html"><a href="06_Section5.8.5.html#outcome-analsis-multilevel-1"><i class="fa fa-check"></i><b>7.2.8</b> Outcome Analsis: Multilevel<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="07_Section5.8.6.html"><a href="07_Section5.8.6.html"><i class="fa fa-check"></i><b>8</b> Section 5.8.6 Comparison of Rand-gbm and Stata-boost (PS)<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="07_Section5.8.6.html"><a href="07_Section5.8.6.html#import-data-2"><i class="fa fa-check"></i><b>8.1</b> Import Data<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="07_Section5.8.6.html"><a href="07_Section5.8.6.html#optimal-pair-matching-using-pscores-generated-by-rand-gbm-ps"><i class="fa fa-check"></i><b>8.2</b> Optimal pair matching Using pscores generated by Rand-gbm (ps)<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="07_Section5.8.6.html"><a href="07_Section5.8.6.html#optimal-pair-matching-using-pscores-generated-by-stata-boost-psb"><i class="fa fa-check"></i><b>8.3</b> Optimal pair matching Using pscores generated by Stata-boost (psb)<span></span></a></li>
<li class="chapter" data-level="8.4" data-path="07_Section5.8.6.html"><a href="07_Section5.8.6.html#balance-checks"><i class="fa fa-check"></i><b>8.4</b> Balance Checks<span></span></a></li>
<li class="chapter" data-level="8.5" data-path="07_Section5.8.6.html"><a href="07_Section5.8.6.html#postmatching-regression-analysis-using-difference-scores"><i class="fa fa-check"></i><b>8.5</b> Postmatching Regression Analysis Using Difference Scores<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html"><i class="fa fa-check"></i><b>9</b> Section 6.5.2 Subclassification &amp; Cox Proportional Hazards (PS)<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#import-data-3"><i class="fa fa-check"></i><b>9.1</b> Import Data<span></span></a></li>
<li class="chapter" data-level="9.2" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#create-propensity-score-using-logistic"><i class="fa fa-check"></i><b>9.2</b> Create Propensity Score Using Logistic<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#function-to-conduct-balance-check-using-normalized-difference"><i class="fa fa-check"></i><b>9.3</b> Function to Conduct Balance Check Using Normalized Difference<span></span></a></li>
<li class="chapter" data-level="9.4" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#balance-check-on-the-original-sample-normalized-difference"><i class="fa fa-check"></i><b>9.4</b> Balance Check on the Original Sample (Normalized Difference)<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#function-to-check-balance-using-chi-square-tests"><i class="fa fa-check"></i><b>9.5</b> Function to Check Balance Using Chi-Square Tests<span></span></a></li>
<li class="chapter" data-level="9.6" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#balance-check-on-the-original-sample-chi-square"><i class="fa fa-check"></i><b>9.6</b> Balance Check on the Original Sample (Chi-Square)<span></span></a></li>
<li class="chapter" data-level="9.7" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#get-quintiles"><i class="fa fa-check"></i><b>9.7</b> Get Quintiles<span></span></a></li>
<li class="chapter" data-level="9.8" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#create-5-subclasses-using-quintiles"><i class="fa fa-check"></i><b>9.8</b> Create 5 Subclasses Using Quintiles<span></span></a></li>
<li class="chapter" data-level="9.9" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#check-imbalance-post-subclassification-5-subclasses"><i class="fa fa-check"></i><b>9.9</b> Check Imbalance Post-Subclassification (5 Subclasses)<span></span></a></li>
<li class="chapter" data-level="9.10" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#trimming-search-for-best-cutoff-alpha-for-overlap"><i class="fa fa-check"></i><b>9.10</b> Trimming: Search for Best Cutoff Alpha for Overlap<span></span></a></li>
<li class="chapter" data-level="9.11" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#trim-observations"><i class="fa fa-check"></i><b>9.11</b> Trim Observations<span></span></a></li>
<li class="chapter" data-level="9.12" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#create-5-new-subclasses-and-check-imbalance"><i class="fa fa-check"></i><b>9.12</b> Create 5 New Subclasses and Check Imbalance<span></span></a></li>
<li class="chapter" data-level="9.13" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#outcome-analysis-by-subclass"><i class="fa fa-check"></i><b>9.13</b> Outcome Analysis by Subclass<span></span></a></li>
<li class="chapter" data-level="9.14" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#aggregate-results"><i class="fa fa-check"></i><b>9.14</b> Aggregate Results<span></span></a></li>
<li class="chapter" data-level="9.15" data-path="08_Section6.5.2.html"><a href="08_Section6.5.2.html#subclassification-with-matchit"><i class="fa fa-check"></i><b>9.15</b> Subclassification with MatchIt<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html"><i class="fa fa-check"></i><b>10</b> Section 7.3.1 Propensity Score Weighting (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#preparation-4"><i class="fa fa-check"></i><b>10.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#solution-1-obtain-weights-with-weightit"><i class="fa fa-check"></i><b>10.2</b> Solution 1: Obtain Weights with WeightIt<span></span></a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#weights"><i class="fa fa-check"></i><b>10.2.1</b> Weights<span></span></a></li>
<li class="chapter" data-level="10.2.2" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#psw-with-ate-weights"><i class="fa fa-check"></i><b>10.2.2</b> PSW With ATE Weights<span></span></a></li>
<li class="chapter" data-level="10.2.3" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#psw-with-att-weights"><i class="fa fa-check"></i><b>10.2.3</b> PSW With ATT Weights<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#solution-2-creating-the-weights-manually"><i class="fa fa-check"></i><b>10.3</b> Solution 2: Creating the Weights Manually<span></span></a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#weights-1"><i class="fa fa-check"></i><b>10.3.1</b> Weights<span></span></a></li>
<li class="chapter" data-level="10.3.2" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#psw-with-ate-weights-1"><i class="fa fa-check"></i><b>10.3.2</b> PSW With ATE Weights<span></span></a></li>
<li class="chapter" data-level="10.3.3" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#psw-with-att-weights-1"><i class="fa fa-check"></i><b>10.3.3</b> PSW With ATT Weights<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="09_Section7.3.1.html"><a href="09_Section7.3.1.html#imbalance-checks"><i class="fa fa-check"></i><b>10.4</b> Imbalance Checks<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html"><i class="fa fa-check"></i><b>11</b> Section 7.3.2 Propensity Score Weighting With a Cox Proportional Hazards Model (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html#preparation-5"><i class="fa fa-check"></i><b>11.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="11.2" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html#propensity-score-weighting"><i class="fa fa-check"></i><b>11.2</b> Propensity Score Weighting<span></span></a></li>
<li class="chapter" data-level="11.3" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html#cox-proportional-hazards-model"><i class="fa fa-check"></i><b>11.3</b> Cox Proportional Hazards Model<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html#checking-imbalance"><i class="fa fa-check"></i><b>11.4</b> Checking Imbalance<span></span></a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html#chi-square-tests-original-sample"><i class="fa fa-check"></i><b>11.4.1</b> Chi-square Tests: Original Sample<span></span></a></li>
<li class="chapter" data-level="11.4.2" data-path="10_Section7.3.2.html"><a href="10_Section7.3.2.html#weighted-logistic-regression"><i class="fa fa-check"></i><b>11.4.2</b> Weighted Logistic Regression<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html"><i class="fa fa-check"></i><b>12</b> Section 8.4.1 Matching with Bias-Corrected and Robust Variance Estimators (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#preparation-6"><i class="fa fa-check"></i><b>12.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="12.2" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#breusch-pagan-test-for-heteroskedasticity"><i class="fa fa-check"></i><b>12.2</b> Breusch-Pagan Test for Heteroskedasticity<span></span></a></li>
<li class="chapter" data-level="12.3" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#matching-estimators"><i class="fa fa-check"></i><b>12.3</b> Matching Estimators<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#sample-average-treatment-effect-sate"><i class="fa fa-check"></i><b>12.3.1</b> Sample Average Treatment Effect (SATE)<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#population-average-treatment-effect-pate"><i class="fa fa-check"></i><b>12.3.2</b> Population Average Treatment Effect (PATE)<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#sample-average-treatment-effect-for-the-treated-satt"><i class="fa fa-check"></i><b>12.3.3</b> Sample average treatment effect for the treated (SATT)<span></span></a></li>
<li class="chapter" data-level="12.3.4" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#population-average-treatment-effect-for-the-treated-patt"><i class="fa fa-check"></i><b>12.3.4</b> Population average treatment effect for the treated (PATT)<span></span></a></li>
<li class="chapter" data-level="12.3.5" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#sample-average-treatment-effect-for-the-controls-satc"><i class="fa fa-check"></i><b>12.3.5</b> Sample average treatment effect for the controls (SATC)<span></span></a></li>
<li class="chapter" data-level="12.3.6" data-path="11_Section8.4.1.html"><a href="11_Section8.4.1.html#population-average-treatment-effect-for-the-controls-patc"><i class="fa fa-check"></i><b>12.3.6</b> Population average treatment effect for the controls (PATC)<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html"><i class="fa fa-check"></i><b>13</b> Section 8.4.2 Efficacy Subset &amp; Matching Estimators (PS)<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#check-sample-sizes-and-get-summary-statistics"><i class="fa fa-check"></i><b>13.1</b> Check Sample Sizes and Get Summary Statistics<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#g4adq"><i class="fa fa-check"></i><b>13.1.1</b> g4adq<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#g4hi"><i class="fa fa-check"></i><b>13.1.2</b> g4hi<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#g5adq"><i class="fa fa-check"></i><b>13.1.3</b> g5adq<span></span></a></li>
<li class="chapter" data-level="13.1.4" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#g5hi"><i class="fa fa-check"></i><b>13.1.4</b> g5hi<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#functions-for-matching"><i class="fa fa-check"></i><b>13.2</b> Functions for Matching<span></span></a></li>
<li class="chapter" data-level="13.3" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#define-matching-variables"><i class="fa fa-check"></i><b>13.3</b> Define Matching Variables<span></span></a></li>
<li class="chapter" data-level="13.4" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#matching-1"><i class="fa fa-check"></i><b>13.4</b> Matching<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#function-to-aggregate-using-rubins-rule"><i class="fa fa-check"></i><b>13.5</b> Function to Aggregate Using Rubin’s Rule<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="12_Section8.4.2.html"><a href="12_Section8.4.2.html#aggregate-using-rubins-rule"><i class="fa fa-check"></i><b>13.6</b> Aggregate Using Rubin’s Rule<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html"><i class="fa fa-check"></i><b>14</b> Section 10.6.1 Modeling Doses of Treatment (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#preparation-7"><i class="fa fa-check"></i><b>14.1</b> Preparation<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#create-treatment-variable"><i class="fa fa-check"></i><b>14.2</b> Create Treatment Variable<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#generalized-propensity-scores"><i class="fa fa-check"></i><b>14.3</b> Generalized Propensity Scores<span></span></a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#mulitinomial-logit-model"><i class="fa fa-check"></i><b>14.3.1</b> Mulitinomial Logit Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#sampling-weights"><i class="fa fa-check"></i><b>14.4</b> Sampling Weights<span></span></a></li>
<li class="chapter" data-level="14.5" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#dummy-variables"><i class="fa fa-check"></i><b>14.5</b> Dummy Variables<span></span></a></li>
<li class="chapter" data-level="14.6" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#regression"><i class="fa fa-check"></i><b>14.6</b> Regression<span></span></a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#without-control"><i class="fa fa-check"></i><b>14.6.1</b> Without Control<span></span></a></li>
<li class="chapter" data-level="14.6.2" data-path="13_Section10.6.1.html"><a href="13_Section10.6.1.html#with-control"><i class="fa fa-check"></i><b>14.6.2</b> With Control<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="14_Section11.5.1_11.5.2.html"><a href="14_Section11.5.1_11.5.2.html"><i class="fa fa-check"></i><b>15</b> Section 11.5.1 &amp; 11.5.2 Sensitivity Analysis of the Effects (SD &amp; PS)<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="14_Section11.5.1_11.5.2.html"><a href="14_Section11.5.1_11.5.2.html#section-11.5.1-sensitivity-analysis-of-the-effects"><i class="fa fa-check"></i><b>15.1</b> Section 11.5.1 Sensitivity Analysis of the Effects<span></span></a></li>
<li class="chapter" data-level="15.2" data-path="14_Section11.5.1_11.5.2.html"><a href="14_Section11.5.1_11.5.2.html#section-11.5.2-sensitivity-analysis-pair-matching"><i class="fa fa-check"></i><b>15.2</b> Section 11.5.2 Sensitivity Analysis &amp; Pair Matching<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="15_SessionInfo.html"><a href="15_SessionInfo.html"><i class="fa fa-check"></i><b>16</b> Session Info<span></span></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Code for <em>Propensity Score Analysis</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-5.8.5-multilevel-propensity-score-ps" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Section 5.8.5 Multilevel Propensity Score (PS)<a href="06_Section5.8.5.html#section-5.8.5-multilevel-propensity-score-ps" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="06_Section5.8.5.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb291-2"><a href="06_Section5.8.5.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb291-3"><a href="06_Section5.8.5.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb291-4"><a href="06_Section5.8.5.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb291-5"><a href="06_Section5.8.5.html#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb291-6"><a href="06_Section5.8.5.html#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plm)</span>
<span id="cb291-7"><a href="06_Section5.8.5.html#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb291-8"><a href="06_Section5.8.5.html#cb291-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb291-9"><a href="06_Section5.8.5.html#cb291-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjlabelled)</span>
<span id="cb291-10"><a href="06_Section5.8.5.html#cb291-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb291-11"><a href="06_Section5.8.5.html#cb291-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span></code></pre></div>
<div id="cccpros57" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> cccpros57<a href="06_Section5.8.5.html#cccpros57" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="import-data" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Import Data<a href="06_Section5.8.5.html#import-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="06_Section5.8.5.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove formats and labels, because matchit requires a vector for the distance option</span></span>
<span id="cb292-2"><a href="06_Section5.8.5.html#cb292-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/Data_Chapter5/cccpros57.dta&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-3"><a href="06_Section5.8.5.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">zap_formats</span>()</span>
<span id="cb292-4"><a href="06_Section5.8.5.html#cb292-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> sjlabelled<span class="sc">::</span><span class="fu">remove_all_labels</span>(df) <span class="sc">%&gt;%</span></span>
<span id="cb292-5"><a href="06_Section5.8.5.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb292-6"><a href="06_Section5.8.5.html#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="06_Section5.8.5.html#cb292-7" aria-hidden="true" tabindex="-1"></a>post1 <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/Data_Chapter5/post1.dta&quot;</span>)</span>
<span id="cb292-8"><a href="06_Section5.8.5.html#cb292-8" aria-hidden="true" tabindex="-1"></a>post2 <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/Data_Chapter5/post2.dta&quot;</span>)</span></code></pre></div>
</div>
<div id="obtain-single-level-p-score" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Obtain Single-Level p-score<a href="06_Section5.8.5.html#obtain-single-level-p-score" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="06_Section5.8.5.html#cb293-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="st">&quot;intschb ~ agey + female + black + hisp + pcedu + incpovlr + pcempf + </span></span>
<span id="cb293-2"><a href="06_Section5.8.5.html#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="st">          fatherr + AYP05Cs + pmin05s&quot;</span>, <span class="at">family =</span> binomial, <span class="at">data =</span> df)</span>
<span id="cb293-3"><a href="06_Section5.8.5.html#cb293-3" aria-hidden="true" tabindex="-1"></a>m1.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(m1)</span>
<span id="cb293-4"><a href="06_Section5.8.5.html#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(m1.sum<span class="sc">$</span>coefficients[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##            (Intercept)                   agey                 female 
## 38966508817.1685028076           0.8431486659           1.1826521220 
##                  black                   hisp                  pcedu 
##           2.4594809316           0.6102697550           1.1493126863 
##               incpovlr                 pcempf                fatherr 
##           0.9990353470           0.6577613322           0.8748319518 
##                AYP05Cs                pmin05s 
##           0.7456891068           0.0004952084</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="06_Section5.8.5.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(m1))</span></code></pre></div>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                             2.5 %                   97.5 %
## (Intercept) 115570492.22183506191 20081560925616.000000000
## agey                0.51414641226              1.378521524
## female              0.74483328390              1.879544965
## black               1.36262822614              4.486695708
## hisp                0.20603826654              1.745844136
## pcedu               0.99791178543              1.327304722
## incpovlr            0.99638797325              1.001688708
## pcempf              0.40135946992              1.070435734
## fatherr             0.45541386742              1.688725534
## AYP05Cs             0.70816246819              0.782024951
## pmin05s             0.00005024149              0.004414004</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="06_Section5.8.5.html#cb298-1" aria-hidden="true" tabindex="-1"></a>ps_sgl <span class="ot">&lt;-</span> <span class="fu">predict</span>(m1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="co"># equivalent to df$ps_sgl</span></span></code></pre></div>
</div>
<div id="obtain-school-level-p-score-model" class="section level3 hasAnchor" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Obtain School-Level p-score Model<a href="06_Section5.8.5.html#obtain-school-level-p-score-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="06_Section5.8.5.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep the first row/observation for each schbl value</span></span>
<span id="cb299-2"><a href="06_Section5.8.5.html#cb299-2" aria-hidden="true" tabindex="-1"></a>df.school <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb299-3"><a href="06_Section5.8.5.html#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(schbl) <span class="sc">%&gt;%</span></span>
<span id="cb299-4"><a href="06_Section5.8.5.html#cb299-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(schbl) <span class="sc">%&gt;%</span></span>
<span id="cb299-5"><a href="06_Section5.8.5.html#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb299-6"><a href="06_Section5.8.5.html#cb299-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-7"><a href="06_Section5.8.5.html#cb299-7" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="st">&quot;intschb ~ AYP05Cs + pmin05s&quot;</span>, <span class="at">family =</span> binomial, <span class="at">data =</span> df.school)</span>
<span id="cb299-8"><a href="06_Section5.8.5.html#cb299-8" aria-hidden="true" tabindex="-1"></a>m2.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(m2)</span>
<span id="cb299-9"><a href="06_Section5.8.5.html#cb299-9" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(m2.sum<span class="sc">$</span>coefficients[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##     (Intercept)         AYP05Cs         pmin05s 
## 207606.86381660      0.85518059      0.02207066</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="06_Section5.8.5.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(m2))</span></code></pre></div>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                        2.5 %                  97.5 %
## (Intercept) 0.00185810346135 5674025413970693.000000
## AYP05Cs     0.64764761513951                1.048226
## pmin05s     0.00000007544837             2563.223374</code></pre>
</div>
<div id="before-matching-balance-check" class="section level3 hasAnchor" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Before-Matching Balance Check<a href="06_Section5.8.5.html#before-matching-balance-check" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="06_Section5.8.5.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(agey <span class="sc">~</span> intschb, <span class="at">data =</span> df, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  agey by intschb
## t = -0.53426, df = 552, p-value = 0.5934
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -0.10549027  0.06037623
## sample estimates:
## mean in group 0 mean in group 1 
##        7.896591        7.919148</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="06_Section5.8.5.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df<span class="sc">$</span>female, df<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  df$female and df$intschb
## X-squared = 3.0238, df = 1, p-value = 0.08205</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="06_Section5.8.5.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df<span class="sc">$</span>black, df<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  df$black and df$intschb
## X-squared = 40.379, df = 1, p-value = 0.0000000002092</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="06_Section5.8.5.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df<span class="sc">$</span>hisp, df<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  df$hisp and df$intschb
## X-squared = 3.0572, df = 1, p-value = 0.08038</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="06_Section5.8.5.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(pcedu <span class="sc">~</span> intschb, <span class="at">data =</span> df, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  pcedu by intschb
## t = -0.21644, df = 552, p-value = 0.8287
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -0.3750634  0.3006107
## sample estimates:
## mean in group 0 mean in group 1 
##        5.424028        5.461255</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="06_Section5.8.5.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(incpovlr <span class="sc">~</span> intschb, <span class="at">data =</span> df, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  incpovlr by intschb
## t = 3.4934, df = 552, p-value = 0.0005152
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  14.38040 51.32562
## sample estimates:
## mean in group 0 mean in group 1 
##        192.2183        159.3653</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="06_Section5.8.5.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df<span class="sc">$</span>pcempf, df<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  df$pcempf and df$intschb
## X-squared = 1.1468, df = 1, p-value = 0.2842</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="06_Section5.8.5.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df<span class="sc">$</span>fatherr, df<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  df$fatherr and df$intschb
## X-squared = 15.557, df = 1, p-value = 0.00008005</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="06_Section5.8.5.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(AYP05Cs <span class="sc">~</span> intschb, <span class="at">data =</span> df, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  AYP05Cs by intschb
## t = 17.354, df = 552, p-value &lt; 0.00000000000000022
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  10.19661 12.79958
## sample estimates:
## mean in group 0 mean in group 1 
##        72.25972        60.76162</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="06_Section5.8.5.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(pmin05s <span class="sc">~</span> intschb, <span class="at">data =</span> df, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  pmin05s by intschb
## t = -7.5318, df = 552, p-value = 0.0000000000002057
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -0.14393616 -0.08438928
## sample estimates:
## mean in group 0 mean in group 1 
##       0.4747435       0.5889062</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="06_Section5.8.5.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative balance check using matchit</span></span>
<span id="cb324-2"><a href="06_Section5.8.5.html#cb324-2" aria-hidden="true" tabindex="-1"></a>scheme1.before <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">matchit</span>(intschb <span class="sc">~</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> </span>
<span id="cb324-3"><a href="06_Section5.8.5.html#cb324-3" aria-hidden="true" tabindex="-1"></a>                    pcedu <span class="sc">+</span> incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s,</span>
<span id="cb324-4"><a href="06_Section5.8.5.html#cb324-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> df,</span>
<span id="cb324-5"><a href="06_Section5.8.5.html#cb324-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="cn">NULL</span>)</span>
<span id="cb324-6"><a href="06_Section5.8.5.html#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(scheme1.before)</span></code></pre></div>
<pre><code>## 
## Call:
## MatchIt::matchit(formula = intschb ~ agey + female + black + 
##     hisp + pcedu + incpovlr + pcempf + fatherr + AYP05Cs + pmin05s, 
##     data = df, method = NULL)
## 
## Summary of Balance for All Data:
##          Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
## distance        0.7340        0.2547          2.0364     0.8873    0.3968
## agey            7.9191        7.8966          0.0457     0.9721    0.0198
## female          0.5720        0.4982          0.1490          .    0.0737
## black           0.4280        0.1802          0.5009          .    0.2478
## hisp            0.0701        0.1131         -0.1683          .    0.0430
## pcedu           5.4613        5.4240          0.0190     0.8764    0.0151
## incpovlr      159.3653      192.2183         -0.3032     0.9228    0.0817
## pcempf          0.5129        0.5583         -0.0908          .    0.0454
## fatherr         0.7048        0.8445         -0.3063          .    0.1397
## AYP05Cs        60.7616       72.2597         -1.2531     2.1957    0.3322
## pmin05s         0.5889        0.4747          0.5017     4.0809    0.1774
##          eCDF Max
## distance   0.6784
## agey       0.0807
## female     0.0737
## black      0.2478
## hisp       0.0430
## pcedu      0.0356
## incpovlr   0.1365
## pcempf     0.0454
## fatherr    0.1397
## AYP05Cs    0.7951
## pmin05s    0.3471
## 
## 
## Sample Sizes:
##           Control Treated
## All           283     271
## Matched       283     271
## Unmatched       0       0
## Discarded       0       0</code></pre>
</div>
<div id="matching-with-ps_sgl" class="section level3 hasAnchor" number="7.1.5">
<h3><span class="header-section-number">7.1.5</span> Matching with ps_sgl<a href="06_Section5.8.5.html#matching-with-ps_sgl" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Note that the caliper argument in <code>matchit()</code> is “the number of standard deviations of the distance measure within which to draw control units (default = 0, no caliper matching). If a caliper is specified, a control unit within the caliper for a treated unit is randomly selected as the match for that treated unit.”<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="06_Section5.8.5.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a column of x random numbers, sort x in ascending order, calculate caliper with ps_sgl</span></span>
<span id="cb326-2"><a href="06_Section5.8.5.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb326-3"><a href="06_Section5.8.5.html#cb326-3" aria-hidden="true" tabindex="-1"></a>df.scheme1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb326-4"><a href="06_Section5.8.5.html#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb326-5"><a href="06_Section5.8.5.html#cb326-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x)</span>
<span id="cb326-6"><a href="06_Section5.8.5.html#cb326-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-7"><a href="06_Section5.8.5.html#cb326-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 1 - Nearest Neighbor with ps_sgl</span></span>
<span id="cb326-8"><a href="06_Section5.8.5.html#cb326-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb326-9"><a href="06_Section5.8.5.html#cb326-9" aria-hidden="true" tabindex="-1"></a>scheme1 <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">matchit</span>(intschb <span class="sc">~</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span> incpovlr <span class="sc">+</span></span>
<span id="cb326-10"><a href="06_Section5.8.5.html#cb326-10" aria-hidden="true" tabindex="-1"></a>                     pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s,</span>
<span id="cb326-11"><a href="06_Section5.8.5.html#cb326-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df.scheme1,</span>
<span id="cb326-12"><a href="06_Section5.8.5.html#cb326-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>,</span>
<span id="cb326-13"><a href="06_Section5.8.5.html#cb326-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">distance =</span> df.scheme1<span class="sc">$</span>ps_sgl,</span>
<span id="cb326-14"><a href="06_Section5.8.5.html#cb326-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">caliper =</span> .<span class="dv">25</span>, <span class="co"># equivalent to sd(df.scheme1$ps_sgl)*.25</span></span>
<span id="cb326-15"><a href="06_Section5.8.5.html#cb326-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">std.caliper =</span> T, <span class="co"># caliper in standard deviation units</span></span>
<span id="cb326-16"><a href="06_Section5.8.5.html#cb326-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">m.order =</span> <span class="st">&quot;largest&quot;</span>, <span class="co"># descending order of distance measures</span></span>
<span id="cb326-17"><a href="06_Section5.8.5.html#cb326-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb326-18"><a href="06_Section5.8.5.html#cb326-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(df.scheme1<span class="sc">$</span>ps_sgl)<span class="sc">*</span>.<span class="dv">25</span> <span class="sc">==</span> scheme1<span class="sc">$</span>caliper <span class="co"># check caliper</span></span></code></pre></div>
<pre><code>##      
## TRUE</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="06_Section5.8.5.html#cb328-1" aria-hidden="true" tabindex="-1"></a>scheme1.data <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">match.data</span>(scheme1)</span>
<span id="cb328-2"><a href="06_Section5.8.5.html#cb328-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-3"><a href="06_Section5.8.5.html#cb328-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance Check</span></span>
<span id="cb328-4"><a href="06_Section5.8.5.html#cb328-4" aria-hidden="true" tabindex="-1"></a>cobalt<span class="sc">::</span><span class="fu">love.plot</span>(scheme1,</span>
<span id="cb328-5"><a href="06_Section5.8.5.html#cb328-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">&quot;std&quot;</span>,</span>
<span id="cb328-6"><a href="06_Section5.8.5.html#cb328-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">&quot;mean.diffs&quot;</span>),</span>
<span id="cb328-7"><a href="06_Section5.8.5.html#cb328-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(.<span class="dv">1</span>),</span>
<span id="cb328-8"><a href="06_Section5.8.5.html#cb328-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb328-9"><a href="06_Section5.8.5.html#cb328-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="cn">TRUE</span>,</span>
<span id="cb328-10"><a href="06_Section5.8.5.html#cb328-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">s.d.denom =</span> <span class="st">&quot;pooled&quot;</span></span>
<span id="cb328-11"><a href="06_Section5.8.5.html#cb328-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
</div>
<div id="matching-with-ps_sch" class="section level3 hasAnchor" number="7.1.6">
<h3><span class="header-section-number">7.1.6</span> Matching with ps_sch<a href="06_Section5.8.5.html#matching-with-ps_sch" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="06_Section5.8.5.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a column of x random numbers, sort x in ascending order, calculate caliper with ps_sch</span></span>
<span id="cb329-2"><a href="06_Section5.8.5.html#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb329-3"><a href="06_Section5.8.5.html#cb329-3" aria-hidden="true" tabindex="-1"></a>df.scheme2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb329-4"><a href="06_Section5.8.5.html#cb329-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb329-5"><a href="06_Section5.8.5.html#cb329-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(x)</span>
<span id="cb329-6"><a href="06_Section5.8.5.html#cb329-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-7"><a href="06_Section5.8.5.html#cb329-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 2 - Nearest Neighbor with ps_sch</span></span>
<span id="cb329-8"><a href="06_Section5.8.5.html#cb329-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb329-9"><a href="06_Section5.8.5.html#cb329-9" aria-hidden="true" tabindex="-1"></a>scheme2 <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">matchit</span>(intschb <span class="sc">~</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span> incpovlr <span class="sc">+</span></span>
<span id="cb329-10"><a href="06_Section5.8.5.html#cb329-10" aria-hidden="true" tabindex="-1"></a>                     pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s,</span>
<span id="cb329-11"><a href="06_Section5.8.5.html#cb329-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df.scheme2,</span>
<span id="cb329-12"><a href="06_Section5.8.5.html#cb329-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>,</span>
<span id="cb329-13"><a href="06_Section5.8.5.html#cb329-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">distance =</span> df.scheme2<span class="sc">$</span>ps_sch,</span>
<span id="cb329-14"><a href="06_Section5.8.5.html#cb329-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">caliper =</span> .<span class="dv">25</span>, <span class="co"># equivalent to sd(df.scheme2$ps_sch)*.25</span></span>
<span id="cb329-15"><a href="06_Section5.8.5.html#cb329-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">m.order =</span> <span class="st">&quot;largest&quot;</span>, <span class="co"># descending order of distance measures</span></span>
<span id="cb329-16"><a href="06_Section5.8.5.html#cb329-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb329-17"><a href="06_Section5.8.5.html#cb329-17" aria-hidden="true" tabindex="-1"></a>scheme2.data <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">match.data</span>(scheme2)</span>
<span id="cb329-18"><a href="06_Section5.8.5.html#cb329-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-19"><a href="06_Section5.8.5.html#cb329-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance Check</span></span>
<span id="cb329-20"><a href="06_Section5.8.5.html#cb329-20" aria-hidden="true" tabindex="-1"></a>cobalt<span class="sc">::</span><span class="fu">love.plot</span>(scheme2,</span>
<span id="cb329-21"><a href="06_Section5.8.5.html#cb329-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">&quot;std&quot;</span>,</span>
<span id="cb329-22"><a href="06_Section5.8.5.html#cb329-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">&quot;mean.diffs&quot;</span>),</span>
<span id="cb329-23"><a href="06_Section5.8.5.html#cb329-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(.<span class="dv">1</span>),</span>
<span id="cb329-24"><a href="06_Section5.8.5.html#cb329-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb329-25"><a href="06_Section5.8.5.html#cb329-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="cn">TRUE</span>,</span>
<span id="cb329-26"><a href="06_Section5.8.5.html#cb329-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">s.d.denom =</span> <span class="st">&quot;pooled&quot;</span></span>
<span id="cb329-27"><a href="06_Section5.8.5.html#cb329-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
<div id="check-icc" class="section level3 hasAnchor" number="7.1.7">
<h3><span class="header-section-number">7.1.7</span> Check ICC<a href="06_Section5.8.5.html#check-icc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="06_Section5.8.5.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate Stata&#39;s &quot;rho&quot; (ICC) in xtreg</span></span>
<span id="cb330-2"><a href="06_Section5.8.5.html#cb330-2" aria-hidden="true" tabindex="-1"></a>get_icc <span class="ot">&lt;-</span> <span class="cf">function</span>(lmer_obj, group) {</span>
<span id="cb330-3"><a href="06_Section5.8.5.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  sigma_u2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">attr</span>(<span class="fu">VarCorr</span>(lmer_obj)[[group]], <span class="st">&quot;stddev&quot;</span>))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb330-4"><a href="06_Section5.8.5.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  sigma_e2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmer_obj)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb330-5"><a href="06_Section5.8.5.html#cb330-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sigma_u2<span class="sc">/</span>(sigma_u2<span class="sc">+</span>sigma_e2))</span>
<span id="cb330-6"><a href="06_Section5.8.5.html#cb330-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb330-7"><a href="06_Section5.8.5.html#cb330-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-8"><a href="06_Section5.8.5.html#cb330-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Original dataset</span></span>
<span id="cb330-9"><a href="06_Section5.8.5.html#cb330-9" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>schbl), <span class="at">data =</span> df, <span class="at">REML =</span> F)</span>
<span id="cb330-10"><a href="06_Section5.8.5.html#cb330-10" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(m3, <span class="st">&quot;schbl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.1850556</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="06_Section5.8.5.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 1: ICC using school as a clustering variable</span></span>
<span id="cb332-2"><a href="06_Section5.8.5.html#cb332-2" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>schbl), <span class="at">data =</span> post1, <span class="at">REML =</span> F)</span>
<span id="cb332-3"><a href="06_Section5.8.5.html#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(m4, <span class="st">&quot;schbl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.1827006</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="06_Section5.8.5.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 1: ICC using the matched set as a clustering variable (create mset first)</span></span>
<span id="cb334-2"><a href="06_Section5.8.5.html#cb334-2" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>mset), <span class="at">data =</span> post1, <span class="at">REML =</span> F)</span>
<span id="cb334-3"><a href="06_Section5.8.5.html#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(m5, <span class="st">&quot;mset&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.07452924</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="06_Section5.8.5.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 2: ICC using school as a clustering variable</span></span>
<span id="cb336-2"><a href="06_Section5.8.5.html#cb336-2" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>schbl), <span class="at">data =</span> post2, <span class="at">REML =</span> F)</span>
<span id="cb336-3"><a href="06_Section5.8.5.html#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(m6, <span class="st">&quot;schbl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.1930747</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="06_Section5.8.5.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 2: ICC using the matched set as a clustering variable (create mset first)</span></span>
<span id="cb338-2"><a href="06_Section5.8.5.html#cb338-2" aria-hidden="true" tabindex="-1"></a>m7 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>mset), <span class="at">data =</span> post2, <span class="at">REML =</span> F)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="06_Section5.8.5.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(m7, <span class="st">&quot;mset&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="outcome-analsis-multilevel" class="section level3 hasAnchor" number="7.1.8">
<h3><span class="header-section-number">7.1.8</span> Outcome Analsis: Multilevel<a href="06_Section5.8.5.html#outcome-analsis-multilevel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="06_Section5.8.5.html#cb342-1" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb342-2"><a href="06_Section5.8.5.html#cb342-2" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl),</span>
<span id="cb342-3"><a href="06_Section5.8.5.html#cb342-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> df,</span>
<span id="cb342-4"><a href="06_Section5.8.5.html#cb342-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb342-5"><a href="06_Section5.8.5.html#cb342-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccpros57 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl)
##    Data: df
## 
##      AIC      BIC   logLik deviance df.resid 
##   1132.1   1192.6   -552.1   1104.1      540 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.1169 -0.6230 -0.0446  0.6716  4.5429 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  schbl    (Intercept) 0.03177  0.1782  
##  Residual             0.41621  0.6451  
## Number of obs: 554, groups:  schbl, 12
## 
## Fixed effects:
##                Estimate  Std. Error          df t value Pr(&gt;|t|)  
## (Intercept)   0.6912222   1.1150068  17.2991369   0.620   0.5434  
## intschb       0.2313252   0.1417319  11.5995931   1.632   0.1295  
## agey         -0.0329893   0.0582583 547.8266420  -0.566   0.5714  
## female        0.0116071   0.0556196 543.1304500   0.209   0.8348  
## black        -0.1068533   0.0751899 551.0960379  -1.421   0.1558  
## hisp          0.1116060   0.1108651 551.5320199   1.007   0.3145  
## pcedu        -0.0294279   0.0168356 547.7983137  -1.748   0.0810 .
## incpovlr      0.0001694   0.0003295 547.6612236   0.514   0.6074  
## pcempf       -0.0085714   0.0587865 548.5975537  -0.146   0.8841  
## fatherr       0.0274703   0.0761396 546.0925033   0.361   0.7184  
## AYP05Cs       0.0031425   0.0109294  11.2024750   0.288   0.7790  
## pmin05s      -1.0415518   0.5423622   9.7450652  -1.920   0.0845 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.428                                                               
## agey     -0.451 -0.003                                                        
## female   -0.047 -0.014  0.040                                                 
## black     0.039 -0.075  0.002  0.041                                          
## hisp      0.004  0.011 -0.017  0.009  0.232                                   
## pcedu    -0.077 -0.035  0.119 -0.048 -0.067  0.207                            
## incpovlr -0.049  0.014  0.113  0.034  0.207  0.207 -0.373                     
## pcempf   -0.012  0.041 -0.061  0.052 -0.127 -0.111 -0.116 -0.225              
## fatherr  -0.058 -0.007  0.063  0.030  0.222 -0.118 -0.047 -0.230  0.037       
## AYP05Cs  -0.882  0.481  0.022  0.007 -0.056 -0.020 -0.028 -0.019  0.034 -0.022
## pmin05s  -0.784  0.229  0.021 -0.005 -0.139 -0.068 -0.034  0.013  0.025  0.019
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.784</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="06_Section5.8.5.html#cb344-1" aria-hidden="true" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb344-2"><a href="06_Section5.8.5.html#cb344-2" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl),</span>
<span id="cb344-3"><a href="06_Section5.8.5.html#cb344-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> post1,</span>
<span id="cb344-4"><a href="06_Section5.8.5.html#cb344-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb344-5"><a href="06_Section5.8.5.html#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccpros57 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl)
##    Data: post1
## 
##      AIC      BIC   logLik deviance df.resid 
##    399.2    445.2   -185.6    371.2      184 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.4114 -0.6032 -0.0443  0.6692  2.9257 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  schbl    (Intercept) 0.02531  0.1591  
##  Residual             0.36656  0.6054  
## Number of obs: 198, groups:  schbl, 10
## 
## Fixed effects:
##                Estimate  Std. Error          df t value Pr(&gt;|t|)
## (Intercept)   1.0198112   1.5786272  16.3303382   0.646    0.527
## intschb       0.2513471   0.1440230   6.9879211   1.745    0.125
## agey         -0.0595067   0.1066836 193.7636716  -0.558    0.578
## female        0.1039814   0.0917062 192.4232631   1.134    0.258
## black         0.0591394   0.1112419 197.9966270   0.532    0.596
## hisp          0.0407093   0.2259732 188.6752480   0.180    0.857
## pcedu        -0.0262788   0.0282298 194.0906852  -0.931    0.353
## incpovlr     -0.0001293   0.0005047 188.0448990  -0.256    0.798
## pcempf        0.0314214   0.0957509 196.6787517   0.328    0.743
## fatherr       0.0413359   0.1207982 192.5515736   0.342    0.733
## AYP05Cs       0.0016732   0.0143406   8.3323211   0.117    0.910
## pmin05s      -1.3511808   0.8470734  12.0151531  -1.595    0.137
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.208                                                               
## agey     -0.529 -0.006                                                        
## female   -0.014  0.013  0.014                                                 
## black     0.105 -0.005 -0.045  0.208                                          
## hisp      0.006  0.027 -0.062  0.039  0.181                                   
## pcedu    -0.037 -0.011  0.115 -0.132 -0.018  0.024                            
## incpovlr -0.003  0.017  0.010  0.133  0.256  0.104 -0.340                     
## pcempf   -0.042 -0.040 -0.034  0.080 -0.105 -0.064 -0.116 -0.284              
## fatherr  -0.095  0.001  0.019  0.107  0.174 -0.030 -0.075 -0.293  0.124       
## AYP05Cs  -0.821  0.223 -0.012 -0.022 -0.126  0.017 -0.112 -0.025  0.074  0.035
## pmin05s  -0.766  0.125 -0.014 -0.081 -0.230 -0.006 -0.105  0.008  0.024  0.076
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.852</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="06_Section5.8.5.html#cb346-1" aria-hidden="true" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb346-2"><a href="06_Section5.8.5.html#cb346-2" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl),</span>
<span id="cb346-3"><a href="06_Section5.8.5.html#cb346-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> post2,</span>
<span id="cb346-4"><a href="06_Section5.8.5.html#cb346-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb346-5"><a href="06_Section5.8.5.html#cb346-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out3)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccpros57 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl)
##    Data: post2
## 
##      AIC      BIC   logLik deviance df.resid 
##    412.7    458.9   -192.4    384.7      186 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -3.07060 -0.65843 -0.08637  0.64639  2.82804 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  schbl    (Intercept) 0.007886 0.0888  
##  Residual             0.394913 0.6284  
## Number of obs: 200, groups:  schbl, 6
## 
## Fixed effects:
##                Estimate  Std. Error          df t value Pr(&gt;|t|)
## (Intercept)  -1.2416479   1.6329395   9.1879217  -0.760    0.466
## intschb       0.2275477   0.1204337   4.2859290   1.889    0.127
## agey          0.0593026   0.1013635 199.8174428   0.585    0.559
## female        0.0021723   0.0913075 199.8217452   0.024    0.981
## black        -0.0583104   0.1119639 199.3489521  -0.521    0.603
## hisp          0.0997444   0.2225810 199.1519185   0.448    0.655
## pcedu        -0.0290466   0.0298435 193.6725616  -0.973    0.332
## incpovlr     -0.0001440   0.0005401 197.1817950  -0.267    0.790
## pcempf       -0.0056656   0.0968596 196.0481669  -0.058    0.953
## fatherr       0.2021954   0.1271594 199.8855228   1.590    0.113
## AYP05Cs       0.0167172   0.0143067   4.8553601   1.168    0.297
## pmin05s      -0.6566093   0.9255222   4.5321180  -0.709    0.513
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb   0.006                                                               
## agey     -0.592 -0.039                                                        
## female    0.023  0.035  0.010                                                 
## black     0.086 -0.116 -0.014  0.113                                          
## hisp     -0.020  0.002  0.009  0.017  0.176                                   
## pcedu     0.106 -0.068  0.004 -0.100 -0.014 -0.052                            
## incpovlr -0.098 -0.038  0.110  0.132  0.199  0.176 -0.447                     
## pcempf   -0.054  0.155 -0.017  0.033 -0.104 -0.014 -0.146 -0.220              
## fatherr  -0.088  0.043  0.109  0.029  0.176 -0.079  0.005 -0.347  0.114       
## AYP05Cs  -0.848 -0.020  0.114 -0.076 -0.120  0.018 -0.206  0.058  0.057 -0.030
## pmin05s  -0.789 -0.032  0.087 -0.060 -0.178 -0.023 -0.199  0.050  0.059  0.020
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.852</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="06_Section5.8.5.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that lmer() does not use the EM algorithm in Stata&#39;s xtmixed, but the results are similar</span></span>
<span id="cb348-2"><a href="06_Section5.8.5.html#cb348-2" aria-hidden="true" tabindex="-1"></a>out4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccpros57 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb348-3"><a href="06_Section5.8.5.html#cb348-3" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mset),</span>
<span id="cb348-4"><a href="06_Section5.8.5.html#cb348-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> post1,</span>
<span id="cb348-5"><a href="06_Section5.8.5.html#cb348-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>,</span>
<span id="cb348-6"><a href="06_Section5.8.5.html#cb348-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">control=</span><span class="fu">lmerControl</span>(<span class="at">optCtrl=</span><span class="fu">list</span>(<span class="at">maxfun=</span><span class="dv">30000</span>)))</span>
<span id="cb348-7"><a href="06_Section5.8.5.html#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out4)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccpros57 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl) +  
##     (1 | mset)
##    Data: post1
## Control: lmerControl(optCtrl = list(maxfun = 30000))
## 
##      AIC      BIC   logLik deviance df.resid 
##    398.6    447.9   -184.3    368.6      183 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.1782 -0.5565 -0.0578  0.5494  2.8696 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  mset     (Intercept) 0.06665  0.2582  
##  schbl    (Intercept) 0.03020  0.1738  
##  Residual             0.29910  0.5469  
## Number of obs: 198, groups:  mset, 99; schbl, 10
## 
## Fixed effects:
##                 Estimate   Std. Error           df t value Pr(&gt;|t|)
## (Intercept)   0.86819778   1.64132442  18.32532978   0.529    0.603
## intschb       0.25627509   0.14769119   7.32366768   1.735    0.124
## agey         -0.02372054   0.10482779 184.99539019  -0.226    0.821
## female        0.13113839   0.09090378 190.20413511   1.443    0.151
## black         0.07539073   0.11345707 184.67749689   0.664    0.507
## hisp          0.09772452   0.22307047 185.75288181   0.438    0.662
## pcedu        -0.01984058   0.02816233 194.40353852  -0.705    0.482
## incpovlr     -0.00026858   0.00050134 188.22356200  -0.536    0.593
## pcempf        0.04281962   0.09514526 196.31075831   0.450    0.653
## fatherr       0.07114051   0.11820569 180.87910907   0.602    0.548
## AYP05Cs      -0.00007682   0.01531744  10.27769908  -0.005    0.996
## pmin05s      -1.51762130   0.87986778  13.99895548  -1.725    0.107
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.217                                                               
## agey     -0.503 -0.006                                                        
## female   -0.024  0.012  0.036                                                 
## black     0.091 -0.002 -0.035  0.201                                          
## hisp     -0.007  0.022 -0.050  0.036  0.203                                   
## pcedu    -0.024 -0.010  0.106 -0.110  0.012  0.028                            
## incpovlr -0.027  0.018  0.035  0.129  0.244  0.110 -0.364                     
## pcempf   -0.035 -0.040 -0.032  0.081 -0.137 -0.065 -0.120 -0.254              
## fatherr  -0.085 -0.002  0.018  0.120  0.147 -0.043 -0.087 -0.292  0.119       
## AYP05Cs  -0.840  0.233 -0.009 -0.025 -0.114  0.025 -0.111 -0.009  0.063  0.031
## pmin05s  -0.780  0.125 -0.013 -0.078 -0.211 -0.004 -0.111  0.025  0.016  0.068
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.850</code></pre>
</div>
</div>
<div id="cccragg24" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> cccragg24<a href="06_Section5.8.5.html#cccragg24" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="import-data-1" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Import Data<a href="06_Section5.8.5.html#import-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="06_Section5.8.5.html#cb350-1" aria-hidden="true" tabindex="-1"></a>ra <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/Data_Chapter5/cccragg24.dta&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb350-2"><a href="06_Section5.8.5.html#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">zap_formats</span>()</span>
<span id="cb350-3"><a href="06_Section5.8.5.html#cb350-3" aria-hidden="true" tabindex="-1"></a>ra <span class="ot">&lt;-</span> sjlabelled<span class="sc">::</span><span class="fu">remove_all_labels</span>(ra) <span class="sc">%&gt;%</span></span>
<span id="cb350-4"><a href="06_Section5.8.5.html#cb350-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb350-5"><a href="06_Section5.8.5.html#cb350-5" aria-hidden="true" tabindex="-1"></a>post3 <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/Data_Chapter5/post3.dta&quot;</span>)</span>
<span id="cb350-6"><a href="06_Section5.8.5.html#cb350-6" aria-hidden="true" tabindex="-1"></a>post4 <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;data/Data_Chapter5/post4.dta&quot;</span>)</span></code></pre></div>
</div>
<div id="obtain-single-level-p-score-1" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Obtain Single-Level p-score<a href="06_Section5.8.5.html#obtain-single-level-p-score-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="06_Section5.8.5.html#cb351-1" aria-hidden="true" tabindex="-1"></a>ra_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="st">&quot;intschb ~ agey + female + black + hisp + pcedu + incpovlr + pcempf + </span></span>
<span id="cb351-2"><a href="06_Section5.8.5.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="st">          fatherr + AYP05Cs + pmin05s&quot;</span>, <span class="at">family =</span> binomial, <span class="at">data =</span> ra)</span>
<span id="cb351-3"><a href="06_Section5.8.5.html#cb351-3" aria-hidden="true" tabindex="-1"></a>ra_glm_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(ra_glm)</span>
<span id="cb351-4"><a href="06_Section5.8.5.html#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(ra_glm_sum<span class="sc">$</span>coefficients[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##        (Intercept)               agey             female              black 
## 63047622.532016911        0.838656988        1.232935406        2.349062618 
##               hisp              pcedu           incpovlr             pcempf 
##        0.960575635        1.110584039        1.001039226        0.658712488 
##            fatherr            AYP05Cs            pmin05s 
##        1.289773619        0.807745966        0.001351376</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="06_Section5.8.5.html#cb353-1" aria-hidden="true" tabindex="-1"></a>ra_ps_sgl <span class="ot">&lt;-</span> <span class="fu">predict</span>(ra_glm, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
</div>
<div id="obtain-school-level-p-score-model-1" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Obtain School-Level p-score Model<a href="06_Section5.8.5.html#obtain-school-level-p-score-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="06_Section5.8.5.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep the first row/observation for each schbl value</span></span>
<span id="cb354-2"><a href="06_Section5.8.5.html#cb354-2" aria-hidden="true" tabindex="-1"></a>ra_school <span class="ot">&lt;-</span> ra <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="06_Section5.8.5.html#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(schbl) <span class="sc">%&gt;%</span></span>
<span id="cb354-4"><a href="06_Section5.8.5.html#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(schbl) <span class="sc">%&gt;%</span></span>
<span id="cb354-5"><a href="06_Section5.8.5.html#cb354-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb354-6"><a href="06_Section5.8.5.html#cb354-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-7"><a href="06_Section5.8.5.html#cb354-7" aria-hidden="true" tabindex="-1"></a>ra_glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="st">&quot;intschb ~ AYP05Cs + pmin05s&quot;</span>, <span class="at">family =</span> binomial, <span class="at">data =</span> ra_school)</span>
<span id="cb354-8"><a href="06_Section5.8.5.html#cb354-8" aria-hidden="true" tabindex="-1"></a>ra_glm2_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(ra_glm2)</span>
<span id="cb354-9"><a href="06_Section5.8.5.html#cb354-9" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(ra_glm_sum<span class="sc">$</span>coefficients[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##        (Intercept)               agey             female              black 
## 63047622.532016911        0.838656988        1.232935406        2.349062618 
##               hisp              pcedu           incpovlr             pcempf 
##        0.960575635        1.110584039        1.001039226        0.658712488 
##            fatherr            AYP05Cs            pmin05s 
##        1.289773619        0.807745966        0.001351376</code></pre>
</div>
<div id="before-matching-balance-check-1" class="section level3 hasAnchor" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Before-Matching Balance Check<a href="06_Section5.8.5.html#before-matching-balance-check-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="06_Section5.8.5.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(agey <span class="sc">~</span> intschb, <span class="at">data =</span> ra, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  agey by intschb
## t = 0.79153, df = 585, p-value = 0.429
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -0.04743792  0.11148723
## sample estimates:
## mean in group 0 mean in group 1 
##        7.904738        7.872713</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="06_Section5.8.5.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(ra<span class="sc">$</span>female, ra<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  ra$female and ra$intschb
## X-squared = 3.4349, df = 1, p-value = 0.06383</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="06_Section5.8.5.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(ra<span class="sc">$</span>black, ra<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  ra$black and ra$intschb
## X-squared = 24.638, df = 1, p-value = 0.0000006917</code></pre>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="06_Section5.8.5.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(ra<span class="sc">$</span>hisp, ra<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  ra$hisp and ra$intschb
## X-squared = 4.443, df = 1, p-value = 0.03505</code></pre>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="06_Section5.8.5.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(pcedu <span class="sc">~</span> intschb, <span class="at">data =</span> ra, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  pcedu by intschb
## t = -1.9926, df = 585, p-value = 0.04677
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -0.647443176 -0.004681272
## sample estimates:
## mean in group 0 mean in group 1 
##        5.270548        5.596610</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="06_Section5.8.5.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(incpovlr <span class="sc">~</span> intschb, <span class="at">data =</span> ra, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  incpovlr by intschb
## t = 0.42796, df = 585, p-value = 0.6688
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -13.79001  21.47404
## sample estimates:
## mean in group 0 mean in group 1 
##        172.2237        168.3817</code></pre>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="06_Section5.8.5.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(ra<span class="sc">$</span>pcempf, ra<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  ra$pcempf and ra$intschb
## X-squared = 0.93015, df = 1, p-value = 0.3348</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="06_Section5.8.5.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(ra<span class="sc">$</span>fatherr, ra<span class="sc">$</span>intschb, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  ra$fatherr and ra$intschb
## X-squared = 3.6137, df = 1, p-value = 0.05731</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="06_Section5.8.5.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(AYP05Cs <span class="sc">~</span> intschb, <span class="at">data =</span> ra, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  AYP05Cs by intschb
## t = 13.66, df = 585, p-value &lt; 0.00000000000000022
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##   8.272252 11.050358
## sample estimates:
## mean in group 0 mean in group 1 
##        70.86164        61.20034</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="06_Section5.8.5.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(pmin05s <span class="sc">~</span> intschb, <span class="at">data =</span> ra, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  pmin05s by intschb
## t = -4.6302, df = 585, p-value = 0.000004504
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -0.09255402 -0.03742139
## sample estimates:
## mean in group 0 mean in group 1 
##       0.5016288       0.5666165</code></pre>
</div>
<div id="matching-with-ps_sgl-1" class="section level3 hasAnchor" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Matching with ps_sgl<a href="06_Section5.8.5.html#matching-with-ps_sgl-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="06_Section5.8.5.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 1 - Nearest Neighbor with ps_sgl</span></span>
<span id="cb376-2"><a href="06_Section5.8.5.html#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb376-3"><a href="06_Section5.8.5.html#cb376-3" aria-hidden="true" tabindex="-1"></a>ra_scheme1 <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">matchit</span>(intschb <span class="sc">~</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span> </span>
<span id="cb376-4"><a href="06_Section5.8.5.html#cb376-4" aria-hidden="true" tabindex="-1"></a>                                 incpovlr <span class="sc">+</span>pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s,</span>
<span id="cb376-5"><a href="06_Section5.8.5.html#cb376-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> ra,</span>
<span id="cb376-6"><a href="06_Section5.8.5.html#cb376-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>,</span>
<span id="cb376-7"><a href="06_Section5.8.5.html#cb376-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">distance =</span> ra<span class="sc">$</span>ps_sgl,</span>
<span id="cb376-8"><a href="06_Section5.8.5.html#cb376-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">caliper =</span> .<span class="dv">25</span>,</span>
<span id="cb376-9"><a href="06_Section5.8.5.html#cb376-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Fewer control units than treated units; not all treated units will get
## a match.</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="06_Section5.8.5.html#cb378-1" aria-hidden="true" tabindex="-1"></a>ra_scheme1_data <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">match.data</span>(ra_scheme1)</span>
<span id="cb378-2"><a href="06_Section5.8.5.html#cb378-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-3"><a href="06_Section5.8.5.html#cb378-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance Check</span></span>
<span id="cb378-4"><a href="06_Section5.8.5.html#cb378-4" aria-hidden="true" tabindex="-1"></a>cobalt<span class="sc">::</span><span class="fu">love.plot</span>(ra_scheme1,</span>
<span id="cb378-5"><a href="06_Section5.8.5.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">&quot;std&quot;</span>,</span>
<span id="cb378-6"><a href="06_Section5.8.5.html#cb378-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">&quot;mean.diffs&quot;</span>),</span>
<span id="cb378-7"><a href="06_Section5.8.5.html#cb378-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(.<span class="dv">1</span>),</span>
<span id="cb378-8"><a href="06_Section5.8.5.html#cb378-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb378-9"><a href="06_Section5.8.5.html#cb378-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="cn">TRUE</span>,</span>
<span id="cb378-10"><a href="06_Section5.8.5.html#cb378-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">s.d.denom =</span> <span class="st">&quot;pooled&quot;</span></span>
<span id="cb378-11"><a href="06_Section5.8.5.html#cb378-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
</div>
<div id="matching-with-ps_sch-1" class="section level3 hasAnchor" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Matching with ps_sch<a href="06_Section5.8.5.html#matching-with-ps_sch-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="06_Section5.8.5.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scheme 2 - Nearest Neighbor with ps_sch</span></span>
<span id="cb379-2"><a href="06_Section5.8.5.html#cb379-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb379-3"><a href="06_Section5.8.5.html#cb379-3" aria-hidden="true" tabindex="-1"></a>ra_scheme2 <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">matchit</span>(intschb <span class="sc">~</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span> incpovlr <span class="sc">+</span></span>
<span id="cb379-4"><a href="06_Section5.8.5.html#cb379-4" aria-hidden="true" tabindex="-1"></a>                pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s,</span>
<span id="cb379-5"><a href="06_Section5.8.5.html#cb379-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> ra,</span>
<span id="cb379-6"><a href="06_Section5.8.5.html#cb379-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>,</span>
<span id="cb379-7"><a href="06_Section5.8.5.html#cb379-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">distance =</span> ra<span class="sc">$</span>ps_sch,</span>
<span id="cb379-8"><a href="06_Section5.8.5.html#cb379-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">caliper =</span> .<span class="dv">25</span>,</span>
<span id="cb379-9"><a href="06_Section5.8.5.html#cb379-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Fewer control units than treated units; not all treated units will get
## a match.</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="06_Section5.8.5.html#cb381-1" aria-hidden="true" tabindex="-1"></a>ra_scheme2_data <span class="ot">&lt;-</span> MatchIt<span class="sc">::</span><span class="fu">match.data</span>(ra_scheme2)</span>
<span id="cb381-2"><a href="06_Section5.8.5.html#cb381-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-3"><a href="06_Section5.8.5.html#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance Check</span></span>
<span id="cb381-4"><a href="06_Section5.8.5.html#cb381-4" aria-hidden="true" tabindex="-1"></a>cobalt<span class="sc">::</span><span class="fu">love.plot</span>(ra_scheme2,</span>
<span id="cb381-5"><a href="06_Section5.8.5.html#cb381-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">&quot;std&quot;</span>,</span>
<span id="cb381-6"><a href="06_Section5.8.5.html#cb381-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">&quot;mean.diffs&quot;</span>),</span>
<span id="cb381-7"><a href="06_Section5.8.5.html#cb381-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(.<span class="dv">1</span>),</span>
<span id="cb381-8"><a href="06_Section5.8.5.html#cb381-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.order =</span> <span class="st">&quot;unadjusted&quot;</span>,</span>
<span id="cb381-9"><a href="06_Section5.8.5.html#cb381-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="cn">TRUE</span>,</span>
<span id="cb381-10"><a href="06_Section5.8.5.html#cb381-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">s.d.denom =</span> <span class="st">&quot;pooled&quot;</span></span>
<span id="cb381-11"><a href="06_Section5.8.5.html#cb381-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="check-icc-1" class="section level3 hasAnchor" number="7.2.7">
<h3><span class="header-section-number">7.2.7</span> Check ICC<a href="06_Section5.8.5.html#check-icc-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="06_Section5.8.5.html#cb382-1" aria-hidden="true" tabindex="-1"></a>i1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>schbl), <span class="at">data =</span> ra, <span class="at">REML =</span> F)</span>
<span id="cb382-2"><a href="06_Section5.8.5.html#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(i1, <span class="st">&quot;schbl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.07795007</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="06_Section5.8.5.html#cb384-1" aria-hidden="true" tabindex="-1"></a>i2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>schbl), <span class="at">data =</span> post3, <span class="at">REML =</span> F)</span>
<span id="cb384-2"><a href="06_Section5.8.5.html#cb384-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(i2, <span class="st">&quot;schbl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.05052852</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="06_Section5.8.5.html#cb386-1" aria-hidden="true" tabindex="-1"></a>i3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>mset), <span class="at">data =</span> post3, <span class="at">REML =</span> F)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="06_Section5.8.5.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(i3, <span class="st">&quot;mset&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="06_Section5.8.5.html#cb390-1" aria-hidden="true" tabindex="-1"></a>i4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>schbl), <span class="at">data =</span> post4, <span class="at">REML =</span> F)</span>
<span id="cb390-2"><a href="06_Section5.8.5.html#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(i4, <span class="st">&quot;schbl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.05130242</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="06_Section5.8.5.html#cb392-1" aria-hidden="true" tabindex="-1"></a>i5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>mset), <span class="at">data =</span> post4, <span class="at">REML =</span> F)</span>
<span id="cb392-2"><a href="06_Section5.8.5.html#cb392-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_icc</span>(i5, <span class="st">&quot;mset&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.1915563</code></pre>
</div>
<div id="outcome-analsis-multilevel-1" class="section level3 hasAnchor" number="7.2.8">
<h3><span class="header-section-number">7.2.8</span> Outcome Analsis: Multilevel<a href="06_Section5.8.5.html#outcome-analsis-multilevel-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="06_Section5.8.5.html#cb394-1" aria-hidden="true" tabindex="-1"></a>ra_out1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb394-2"><a href="06_Section5.8.5.html#cb394-2" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl),</span>
<span id="cb394-3"><a href="06_Section5.8.5.html#cb394-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> ra,</span>
<span id="cb394-4"><a href="06_Section5.8.5.html#cb394-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb394-5"><a href="06_Section5.8.5.html#cb394-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ra_out1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccragg24 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl)
##    Data: ra
## 
##      AIC      BIC   logLik deviance df.resid 
##   1126.8   1188.0   -549.4   1098.8      573 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8820 -0.5803  0.0780  0.5367  3.3552 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  schbl    (Intercept) 0.02068  0.1438  
##  Residual             0.37063  0.6088  
## Number of obs: 587, groups:  schbl, 12
## 
## Fixed effects:
##                 Estimate   Std. Error           df t value Pr(&gt;|t|)
## (Intercept)   0.44505943   0.92667699  20.80649307   0.480    0.636
## intschb      -0.19656648   0.11357659  12.48761677  -1.731    0.108
## agey          0.07941009   0.05382555 582.22221593   1.475    0.141
## female        0.03161287   0.05082602 576.34561568   0.622    0.534
## black        -0.01901878   0.06731344 585.73246960  -0.283    0.778
## hisp          0.08005447   0.10498239 584.71862879   0.763    0.446
## pcedu         0.01859684   0.01556726 582.82205863   1.195    0.233
## incpovlr     -0.00002751   0.00030395 583.45375442  -0.090    0.928
## pcempf       -0.01315617   0.05343864 584.32266097  -0.246    0.806
## fatherr       0.00938409   0.06573253 582.51785428   0.143    0.887
## AYP05Cs      -0.01264483   0.00876189  11.84124707  -1.443    0.175
## pmin05s      -0.74186729   0.45384409  11.98884397  -1.635    0.128
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.401                                                               
## agey     -0.496  0.010                                                        
## female   -0.050 -0.027  0.042                                                 
## black     0.020 -0.070  0.003  0.018                                          
## hisp      0.019 -0.009 -0.025  0.015  0.234                                   
## pcedu    -0.112 -0.032  0.121 -0.063 -0.009  0.204                            
## incpovlr -0.035 -0.023  0.106  0.051  0.191  0.218 -0.367                     
## pcempf   -0.004  0.045 -0.051  0.016 -0.154 -0.087 -0.102 -0.193              
## fatherr  -0.034 -0.027  0.049  0.028  0.200 -0.151 -0.054 -0.231 -0.037       
## AYP05Cs  -0.856  0.455  0.020  0.005 -0.031 -0.033 -0.003 -0.037  0.025 -0.039
## pmin05s  -0.767  0.231  0.023  0.003 -0.148 -0.083 -0.015 -0.002  0.015  0.006
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.783</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="06_Section5.8.5.html#cb396-1" aria-hidden="true" tabindex="-1"></a>ra_out2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb396-2"><a href="06_Section5.8.5.html#cb396-2" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl),</span>
<span id="cb396-3"><a href="06_Section5.8.5.html#cb396-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> post3,</span>
<span id="cb396-4"><a href="06_Section5.8.5.html#cb396-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb396-5"><a href="06_Section5.8.5.html#cb396-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ra_out2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccragg24 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl)
##    Data: post3
## 
##      AIC      BIC   logLik deviance df.resid 
##    531.1    580.8   -251.5    503.1      244 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.7352 -0.5681  0.0571  0.5068  3.0213 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  schbl    (Intercept) 0.01501  0.1225  
##  Residual             0.40105  0.6333  
## Number of obs: 258, groups:  schbl, 12
## 
## Fixed effects:
##                 Estimate   Std. Error           df t value Pr(&gt;|t|)  
## (Intercept)   0.00355236   1.22511662  30.59643738   0.003   0.9977  
## intschb      -0.12316154   0.11591401   9.60776615  -1.063   0.3140  
## agey          0.16194551   0.09043449 255.90423248   1.791   0.0745 .
## female       -0.03125581   0.08099518 251.69678848  -0.386   0.6999  
## black        -0.06630285   0.09716807 257.80775401  -0.682   0.4956  
## hisp         -0.05398092   0.22522493 254.67539409  -0.240   0.8108  
## pcedu         0.00321377   0.02638440 256.13958504   0.122   0.9031  
## incpovlr     -0.00004034   0.00049467 253.79053324  -0.082   0.9351  
## pcempf       -0.03234786   0.08712100 257.89077137  -0.371   0.7107  
## fatherr       0.07079410   0.10683566 257.96375589   0.663   0.5081  
## AYP05Cs      -0.01572501   0.01049485  12.62583098  -1.498   0.1586  
## pmin05s      -0.54183591   0.59338036  18.67049306  -0.913   0.3728  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.160                                                               
## agey     -0.615 -0.003                                                        
## female   -0.052 -0.027  0.040                                                 
## black     0.007 -0.006  0.017  0.116                                          
## hisp      0.027  0.022 -0.091  0.022  0.209                                   
## pcedu    -0.116 -0.011  0.112 -0.036  0.013  0.019                            
## incpovlr -0.003  0.012  0.088  0.082  0.222  0.140 -0.412                     
## pcempf    0.022 -0.023 -0.117  0.091 -0.142 -0.011 -0.102 -0.232              
## fatherr  -0.010 -0.009 -0.041  0.012  0.088 -0.102  0.016 -0.331 -0.049       
## AYP05Cs  -0.780  0.188  0.029 -0.017 -0.041  0.023 -0.051 -0.075  0.074 -0.038
## pmin05s  -0.719  0.050  0.021 -0.028 -0.181 -0.030 -0.051 -0.032  0.007  0.046
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.826</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="06_Section5.8.5.html#cb398-1" aria-hidden="true" tabindex="-1"></a>ra_out3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb398-2"><a href="06_Section5.8.5.html#cb398-2" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl),</span>
<span id="cb398-3"><a href="06_Section5.8.5.html#cb398-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> post4,</span>
<span id="cb398-4"><a href="06_Section5.8.5.html#cb398-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb398-5"><a href="06_Section5.8.5.html#cb398-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ra_out3)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccragg24 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl)
##    Data: post4
## 
##      AIC      BIC   logLik deviance df.resid 
##    511.1    560.6   -241.5    483.1      240 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6880 -0.5859  0.0529  0.4843  3.2563 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  schbl    (Intercept) 0.00128  0.03577 
##  Residual             0.39096  0.62527 
## Number of obs: 254, groups:  schbl, 7
## 
## Fixed effects:
##                 Estimate   Std. Error           df t value Pr(&gt;|t|)  
## (Intercept)   1.09709583   1.19341507  13.34615431   0.919   0.3743  
## intschb      -0.10696919   0.08524443   6.33137228  -1.255   0.2539  
## agey          0.02529304   0.09186204 253.36723409   0.275   0.7833  
## female        0.13416143   0.07965086 250.29881755   1.684   0.0934 .
## black         0.05193543   0.09994578 251.59262147   0.520   0.6038  
## hisp         -0.03404747   0.21252278 249.85982494  -0.160   0.8728  
## pcedu         0.01362782   0.02547170 253.96608169   0.535   0.5931  
## incpovlr     -0.00003668   0.00047039 253.22022061  -0.078   0.9379  
## pcempf        0.02919453   0.08242162 252.61959792   0.354   0.7235  
## fatherr       0.10313539   0.10286490 253.68799736   1.003   0.3170  
## AYP05Cs      -0.02139554   0.00958739   5.05899405  -2.232   0.0754 .
## pmin05s      -0.37482131   0.65921741   5.54584079  -0.569   0.5919  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.045                                                               
## agey     -0.644 -0.019                                                        
## female   -0.086 -0.018  0.078                                                 
## black     0.069 -0.161 -0.011  0.066                                          
## hisp     -0.005 -0.045 -0.028 -0.056  0.166                                   
## pcedu     0.003 -0.108  0.039 -0.074  0.091  0.100                            
## incpovlr -0.055 -0.067  0.116  0.072  0.153  0.167 -0.382                     
## pcempf   -0.042  0.080 -0.071  0.036 -0.077  0.030 -0.054 -0.203              
## fatherr  -0.068 -0.015  0.063  0.020  0.192 -0.131 -0.018 -0.302  0.012       
## AYP05Cs  -0.763  0.051  0.035  0.005 -0.104  0.007 -0.128 -0.044  0.100 -0.040
## pmin05s  -0.710  0.057  0.016  0.005 -0.230 -0.023 -0.174  0.016  0.049  0.032
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.849</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="06_Section5.8.5.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that lmer() does not use the EM algorithm in Stata&#39;s xtmixed</span></span>
<span id="cb400-2"><a href="06_Section5.8.5.html#cb400-2" aria-hidden="true" tabindex="-1"></a>ra_out4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(cccragg24 <span class="sc">~</span> intschb <span class="sc">+</span> agey <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> hisp <span class="sc">+</span> pcedu <span class="sc">+</span></span>
<span id="cb400-3"><a href="06_Section5.8.5.html#cb400-3" aria-hidden="true" tabindex="-1"></a>             incpovlr <span class="sc">+</span> pcempf <span class="sc">+</span> fatherr <span class="sc">+</span> AYP05Cs <span class="sc">+</span> pmin05s <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>schbl) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mset),</span>
<span id="cb400-4"><a href="06_Section5.8.5.html#cb400-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> post4,</span>
<span id="cb400-5"><a href="06_Section5.8.5.html#cb400-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">FALSE</span>,</span>
<span id="cb400-6"><a href="06_Section5.8.5.html#cb400-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">control=</span><span class="fu">lmerControl</span>(<span class="at">optCtrl=</span><span class="fu">list</span>(<span class="at">maxfun=</span><span class="dv">30000</span>)))</span>
<span id="cb400-7"><a href="06_Section5.8.5.html#cb400-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ra_out4)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: cccragg24 ~ intschb + agey + female + black + hisp + pcedu +  
##     incpovlr + pcempf + fatherr + AYP05Cs + pmin05s + (1 | schbl) +  
##     (1 | mset)
##    Data: post4
## Control: lmerControl(optCtrl = list(maxfun = 30000))
## 
##      AIC      BIC   logLik deviance df.resid 
##    509.6    562.6   -239.8    479.6      239 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.3653 -0.5190  0.0556  0.5112  2.9183 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  mset     (Intercept) 0.067181 0.25919 
##  schbl    (Intercept) 0.004645 0.06815 
##  Residual             0.321605 0.56710 
## Number of obs: 254, groups:  mset, 127; schbl, 7
## 
## Fixed effects:
##                 Estimate   Std. Error           df t value Pr(&gt;|t|)  
## (Intercept)   1.07899536   1.28793876  13.49164645   0.838   0.4168  
## intschb      -0.11506523   0.09065629   6.28988597  -1.269   0.2493  
## agey          0.03082777   0.09012865 240.42202105   0.342   0.7326  
## female        0.11357833   0.07927570 249.91017822   1.433   0.1532  
## black         0.04595566   0.09844551 243.50055839   0.467   0.6411  
## hisp         -0.03270908   0.20792136 234.74041010  -0.157   0.8751  
## pcedu         0.01614542   0.02511835 246.43805625   0.643   0.5210  
## incpovlr     -0.00003758   0.00046317 244.59325663  -0.081   0.9354  
## pcempf        0.01030922   0.08082582 239.84989857   0.128   0.8986  
## fatherr       0.11643540   0.10074056 238.92767246   1.156   0.2489  
## AYP05Cs      -0.02171177   0.01113103   6.78125609  -1.951   0.0934 .
## pmin05s      -0.37363177   0.72844547   6.31305169  -0.513   0.6255  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) intsch agey   female black  hisp   pcedu  incpvl pcempf fathrr
## intschb  -0.068                                                               
## agey     -0.582 -0.022                                                        
## female   -0.074 -0.012  0.074                                                 
## black     0.069 -0.150 -0.008  0.044                                          
## hisp     -0.014 -0.041 -0.012 -0.060  0.160                                   
## pcedu     0.000 -0.105  0.046 -0.082  0.092  0.110                            
## incpovlr -0.046 -0.060  0.124  0.083  0.154  0.165 -0.379                     
## pcempf   -0.047  0.076 -0.068  0.036 -0.097  0.021 -0.055 -0.220              
## fatherr  -0.064 -0.018  0.075  0.010  0.194 -0.116 -0.018 -0.297 -0.001       
## AYP05Cs  -0.806  0.076  0.023  0.002 -0.096  0.002 -0.107 -0.048  0.096 -0.039
## pmin05s  -0.750  0.076  0.009  0.005 -0.213 -0.020 -0.157  0.003  0.054  0.023
##          AYP05C
## intschb        
## agey           
## female         
## black          
## hisp           
## pcedu          
## incpovlr       
## pcempf         
## fatherr        
## AYP05Cs        
## pmin05s   0.851</code></pre>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p><a href="https://r.iq.harvard.edu/docs/matchit/2.4-14/Additional_Arguments_f3.html" class="uri">https://r.iq.harvard.edu/docs/matchit/2.4-14/Additional_Arguments_f3.html</a><a href="06_Section5.8.5.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="05_Section5.8.2_5.8.3_5.8.4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="07_Section5.8.6.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
